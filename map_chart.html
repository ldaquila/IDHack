<html>
  <head>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["geomap"]});
      google.setOnLoadCallback(drawMap);
      function drawMap() {
        var data = google.visualization.arrayToDataTable([
          ['Country', 'Presence'],
          ['Germany', 200],
          ['United States', 300],
          ['Brazil', 400],
          ['Canada', 500],
          ['France', 600],
          ['RU', 700]
        ]);

        var options = {};
        options['dataMode'] = 'regions';
        options['region'] = '005';

        var container = document.getElementById('regions_div');
        var geomap = new google.visualization.GeoMap(container);

        geomap.draw(data, options);
      };

      function getOpenings(){
        $.ajax({
            url: 'http://www.peacecorps.gov/api/v1/openings/',
            type: 'GET',
            // data: 'ID=1&Name=John&Age=10', // or $('#myform').serializeArray()
            success: function(data) { 
              alert(JSON.stringify(data));
            }
        });
      };

      /*  callback: callback function
          passes a list of regions to callback
          ex: [africa, easteurope]
      */

      function getRegions(callback){
        $.ajax({
          url: 'http://www.peacecorps.gov/api/v1/geography/regions/',
          type: 'GET',
          success: function(data){
            var regions = [];
            for (var i = 0; i < data.length; i++){
              regions.push(data[i]['slug']);
            }
            callback(regions);
          }
        });
      }

      /*
        callback: callback function
        passes an object that maps regions to corresponding countries to callback function

        ex: {africa: [congo, nigeria], asia: [thailand, laos]}

      */
      function getCountriesByRegion(callback){
        getRegions(function(regions){
          // initialize hashmap
          var map = new Object();
          for (var i = 0; i < regions.length; i++){
            map[regions[i]] = []
          }
          // get countries
          $.ajax({
            url: 'http://www.peacecorps.gov/api/v1/geography/countries/?current=true',
            type: 'GET',
            success: function(data){
              for (var i = 0; i < data.length; i++){
                map[data[i]['region']].push(data[i]['slug']);
              }
              callback(map);
            }
          });
        });
        
      }


      getCountriesByRegion(function(countries){
        console.log(countries);
        
      });

    </script>
  </head>
  <body>
    <div id="regions_div" style="width: 900px; height: 500px;"></div>
  </body>
</html>